---
title: "Aplicación 1.1. Curva de Engel para el gasto en alimentos"
author: "J. Ramajo"
date: '2020'
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## El modelo de regresión lineal simple (con dos variables)

En este primer ejemplo veremos cómo realizar con R una estimación por mínimos cuadrados ordinarios (MCO) de un modelo de regesión simple, con dos variables.
Utilizaremos un documento de R Markdown (<http://rmarkdown.rstudio.com>) para ejecutar los comandos y reproducir los resultados.

```{r}
library(readr)
engel <- read_delim("ENGEL_ALIM_1.csv",  ";", escape_double = FALSE, trim_ws = TRUE)
library(stargazer)
# Estadísticos descriptivos
head(engel)
summary(engel)
# Diagrama de puntos (scatter plot) de las varialbes x e y.
plot(engel$RENTA, engel$GALIM,
ylim=c(0, max(engel$GALIM)),
xlim=c(0, max(engel$RENTA)),
xlab="Renta",
ylab="Gasto en alimentos",
type = "p")
```

# Estimación de la regresión lineal: 
# GALIM_i = beta_1 + beta_2 * RENTA_i + e_i

```{r }
# Estimación de un modelo por MCO y anclaje de los resultados en el objeto "ols"
ols <- lm(GALIM ~ RENTA, data = engel) 
#
# Resumen de resultados
summary(ols)
ols$coefficients
(b1 <- coef(ols)[[1]])
(b2 <- coef(ols)[[2]])
vcov(ols)
(varb1 <- vcov(ols)[1, 1])
(varb2 <- vcov(ols)[2, 2])
(covb1b2 <- vcov(ols)[1,2])
#
stargazer(ols, type = "text", title = "Resultados de la regresión")
```

# Gráficas asociadas al modelo:

```{r }
# Diagrama de puntos y línea de regresión
# Método estándar
b1 <- coef(ols)[[1]]
b2 <- coef(ols)[[2]]
#
plot(engel$RENTA, engel$GALIM,
ylim=c(0, max(engel$GALIM)),
xlim=c(0, max(engel$RENTA)),
xlab="Renta",
ylab="Gasto en alimentos",
type = "p")
abline(b1,b2)
# Gráfica de resultados con el método ggplot
library(ggplot2) 
ggplot(engel, aes(x = RENTA, y = GALIM)) + geom_point() + geom_smooth(method = "lm", se = FALSE) + scale_x_continuous(limits = c(350, 5000), expand = c(0, 0)) + theme_bw() + labs(x = "Renta", y = "Gasto en alimentos")
```

# Predicción con el modelo de regresión simple:

```{r }
ols <- lm(GALIM ~ RENTA, data = engel)
new_RENTA <- data.frame(RENTA=c(400, 2000, 4500))
pred_GALIM <- predict(ols, new_RENTA)
names(pred_GALIM) <-c("Renta = 400", "2000", "4500")
pred_GALIM
```