---
title: 'Instalación y configuración de R, Python y Julia en RStudio'
author:
  name: Julián Ramajo, ramajo@unex.es
  affiliation: GRADO EN ESTADÍSTICA | ECONOMETRIA (502243)
output:
  html_document:
    theme: journal
    highlight: haddock
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Instalación y configuración de R y RStudio

1. Descargar e instalar **R**: <https://cloud.r-project.org/>

2. Descargar e instalar **RStudio**: <https://www.rstudio.com/products/rstudio/download/>

3. Abrir RStudio e instalar las librerías `tidyverse`, `tidymodels`, `shiny`, `rmarkdown` y `flexdashboard`:

```{r, eval=FALSE}
install.packages("tidyverse")
install.packages("tidymodels")
install.packages("shiny")
install.packages("rmarkdown")
install.packages("flexdashboard")
```

## Instalación de la librería Rcpp y Rtools

Se deben instalar la librería `Rcpp` y el software **Rtools** ( <https://cran.r-project.org/bin/windows/Rtools/> ). Ambos se necesitan con frecuencia para acelerar algunas partes del código, así como para compilar paquetes más nuevos en instalaciones antiguas de R.

```{r, eval=FALSE}
install.packages("Rcpp")
```

## Instalación de librerías R

Una vez instalados R y RStudio, el siguiente paso consiste en **instalar las librerías específicas** para realizar análisis estadísticos y econométricos.

Hay una gama increíblemente grande de paquetes disponibles en R: <https://cran.r-project.org/web/packages/available_packages_by_name.html>

Afortunadamente, la mayoría de los paquetes más populares, o muy especializados, están agrupados en diferentes categorías en CRAN TASK Views:  <https://cran.r-project.org/web/views/>

Se pueden instalar fácilmente "paquetes de librerías" usando la librería `ctv`:

```{r, eval=FALSE}
install.packages("ctv")
```

y posteriormente instalando conjuntos de librerías homogéneos:

```{r, eval=FALSE}
ctv::install.views("Econometrics")
ctv::install.views("Finance")
ctv::install.views("TimeSeries")
ctv::install.views("MissingData")
ctv::install.views("Graphics")
ctv::install.views("NumericalMathematics")
ctv::install.views("Psychometrics")
ctv::install.views("SocialSciences")
ctv::install.views("Environmetrics")
ctv::install.views("MachineLearning")
ctv::install.views("Cluster")
ctv::install.views("Survival")
ctv::install.views("Distributions")
ctv::install.views("Multivariate")
ctv::install.views("Optimization")
ctv::install.views("Robust")
ctv::install.views("Spatial")
ctv::install.views("SpatioTemporal")
ctv::install.views("OfficialStatistics")
```

NOTA: Mi recomendación es instalar sólo los paquetes necesarios para el análisis econométrico básico (<https://cran.r-project.org/web/views/Econometrics.html>). Siempre se pueden instalar paquetes adicionales más adelante; de hecho, RStudio nos avisará cuándo un _script_ contiene alguna librería no instalada y nos dará la opción de instalarla antes de ejecutar el código.

# Instalación y configuración de Python en RStudio

Hay varias formas de configurar Python en un ordenador. Los tres métodos más frecuentes son los siguientes:

a) Distribución estándar de **Python**: <https://www.python.org/downloads/>

b) Distribución **Miniconda** de Python: <https://docs.conda.io/en/latest/miniconda.html>

c) Distribución **Anaconda** de Python: <https://www.anaconda.com/>

Tanto la distribución Miniconda como Anaconda utilizan la librería `conda` en sus instalaciones de Python, la cual permite descargar e instalar paquetes adicionales de Python. La instalación estándar de Python utiliza el paquete `pip` para descargar e instalar librerías adicionales de Python.

Para las necesidades de este curso usaremos la distribución **Miniconda**. Lo primero que hay que hacer es configurar el entorno de Python en RStudio/R con la librería `reticulate`. Cuando se ejecuta por primera vez dicha librería se crea una instalación miniconda adaptada a R llamada _R-Miniconda_; también se puede instalar miniconda manualmente utilizando el comando _install_miniconda()_.

```{r, eval=FALSE}
install.packages("reticulate")
library(reticulate)
install_miniconda()
conda_list()
conda_version()
py_config()
```

Si no aparece ninguna instalación de Python volver a intentar la instalación de miniconda: _install_miniconda()_.

Para comprobar que el entorno Python ha sido creado adecuadamente se puede entrar en la consola de Python
y hacer algún pequeño cálculo para ver si la instalación ha sido correcta:


En R usar el comando _repl_python()_ y luego, en la consola de Python, teclear los comandos:

import numpy as np

a = np.sqrt(2)

print(a)

x = 42*2

print(x)

exit  

También desde R se pueden ejecutar algunos comandos Python importando la librería correspondiente:

```{r, eval=FALSE}
library(reticulate)
np <- import("numpy")
np$sqrt(2)
```

O se puede ejecutar un `script de Python (chunk)` y mostrar los resultados en RStudio:

```{python, eval=FALSE}
from matplotlib import pyplot as plt
import numpy as np
#
x = list(range(1, 11))
y = np.random.randn(10)
plt.figure(0)
plt.plot(x, y,  linestyle = "--", color = "blue", marker = "s", label = "Línea 1")
plt.title("Ejemplo de gráfico de líneas")
plt.legend(loc = "upper left")
plt.show()
```

## Creación de un entorno particular (opcional, para aislar entornos de trabajo)

Crear un **entorno conda*_** propio es tan sencillo como generar un nuevo nombre del mismo, tal y como se muestra a continuación:

```{r, eval=FALSE}
mi_entorno <- "Econometria"
conda_create(mi_entorno)
```

Para usar el nuevo entorno de Python en lugar del estándar (`r-reticulate`) debe usarse el siguiente script:

```{r, eval=FALSE}
use_condaenv(mi_entorno)
conda_version()
conda_list()
```

## Instalación de librerías Python

El siguiente paso consiste en instalar las librerías de Python pertinentes en el entorno de R-Miniconda recién creado. La razón por la que queremos usar `reticulate` es para **poder acceder a todas las librerías de Python que instalemos desde R**.

```{r, eval=FALSE}
library(reticulate)
py_install("numpy")
py_install("pandas")
py_install("matplotlib")
py_install("seaborn")
py_install("plotly")
py_install("plotnine")
py_install("pandas-bokeh", pip = TRUE)
py_install("scipy")
py_install("scikit-learn")
py_install("sktime")
py_install("linearmodels")
py_install("statsmodels")
py_install("semopy", pip = TRUE)
py_install("lifelines")
py_install("arch", pip=TRUE)
py_install("appelpy", pip = TRUE)
py_install("datetime", pip =  TRUE)
py_install("stargazer", pip = TRUE)
py_install("mizani")
py_install("xlrd")
py_install("category_encoders")
py_install("pmdarima")
py_install("pyflux", pip = TRUE)
py_install("glmnet")
py_install("pymc3")
py_install("pysal")
# py_install("libpysal")
# py_install("esda")
# py_install("giddy")
# py_install("inequality")
# py_install("pointpats")
# py_install("segregation")
# py_install("spaghetti")
# py_install("mgwr")
# py_install("spglm")
# py_install("spreg")
# py_install("spint")
# py_install("spvcm")
# py_install("tobler")
# py_install("access")
# py_install("spopt")
# py_install("legendgram")
# py_install("mapclassify")
# py_install("splot")
```

# Instalación y configuración de Julia en RStudio

Para poder usar Julia en RStudio, en primer lugar hay que instalar la librería _JuliaCall_,  y luego utilizar instalar **Julia** e inicializarlo:

```{r, eval=FALSE}
install.packages("JuliaCall")
```

**Los comandos siguientes hay que ejecutarlos cada vez que se use Julia en RStudio**:

```{r, eval=FALSE}
library(JuliaCall)
julia_setup(installJulia = TRUE)
```

Para comprobar que el entorno Julia ha sido creado adecuadamente se puede entrar en la consola de Julia y hacer algún pequeño cálculo para ver si la instalación ha sido correcta.

En R usar el comando _julia_console()_ y luego, en la consola de Julia, teclear los comandos:

println(\"Hello World!\")

a=sqrt(2)

x=42*2

exit  

También desde R se pueden ejecutar algunos comandos Julia en R ( _chunck r_) para hacer los mismos cálculos:

```{r, eval=FALSE}
julia_command( "println(\"Hello World!\")"  )
julia_command("a = sqrt(2);")
julia_eval("a")
julia_eval("42*2")
```

O se pueden ejecutar comandos y realizar gráficas en Julia ( _chunck julia_) y mostrarlos en RStudio:

```{julia, eval=FALSE}
a = sqrt(2)
# Si no está instalada la librería concreta se debe instalar previamente
# import Pkg; Pkg.add("Plots")
using Plots
gr() # GR backend sistema de gráficas; se puede usar Plotly -> plotlyjs() , 
plot(Plots.fakedata(50,5),w=3)
#
x = 1:10; y1 = rand(10); # Datos
plot(x, y, title = "Ejemplo de gráfico de líneas", label = ["Línea 1"], lw = 3)
#
gr()
plot(x, y, seriestype = :scatter, title = "Ejemplo de diagrama de puntos")
# 
y = rand(10, 4); # Datos
p1 = plot(x, y)  
p2 = scatter(x, y)
p3 = plot(x, y, xlabel = "Atributo de x", lw = 3, title = "Título") # Con atributos
p4 = histogram(x, y1)
plot(p1, p2, p3, p4, layout = (2, 2), legend = false)
```

También podría ejecutarse la gráfica en un script de R con comandos Julia, sin error, pero no se verá la gráfica ni en la pantalla ni en el R Markdown.

```{r, eval=FALSE}
julia_library("Plots")
julia_command("gr()")
julia_command("display(Plots.plot(Plots.fakedata(50,5),w=3))")
```

Un ejemplo de econometría usando Julia en RStudio ( _chunck julia_ ):

```{julia, eval=FALSE}
# Si no están instaladas las librerías necesarias se deben instalar previamente
# import Pkg; Pkg.add("CSV"); Pkg.add("RDatasets"); Pkg.add("Econometrics")
using CSV, RDatasets, Econometrics
data = RDatasets.dataset("Ecdat", "PSID")
data = data[data.Earnings .> 0 .& data.Kids .< 10,:] # Salarios positivos y un número de hijos menos que 10
modelolineal = fit(EconometricModel, @formula(log(Earnings) ~ Educatn + Age + Age^2), data)
# Pkg.add("GLM")
using GLM
ols = lm(@formula(log(Earnings) ~ Educatn + Age + Age^2), data)
```

## Creación de un entorno particular (Opcional, para aislar entornos de trabajo)

Si se quiere usar `Julia` en una localización específica, debería usarse el siguiente comando de inicialización:

julia_setup(JULIA_HOME = "directorio que contiene los ficheros binarios de Julia")

Por ejemplo, en un Mac, si se tiene instalado Julia 1.7 en el ordenador y quiere utilizarse esa versión, debe utilizarse:

julia_setup(JULIA_HOME = "/Applications/Julia-1.7.app/Contents/Resources/julia/bin/")

o el correspondiente localizador en Windows buscando el directorio donde está el ejecutable del programa Julia.

También se puede asignar el directorio de JULIA_HOME en la consola de comandos o usando `options(...)`.

Por otra parte, para usar un determinado directorio de trabajo debe usarse el comando:

getwd()

setwd("/Users/julian_ramajo/Documentos/JULIA")

## Instalación de librerías Julia

A continuación se procede a instalar las librerías necesarias para estadística y econometría.

```{r, eval=FALSE}
library(JuliaCall)
julia_install_package("Queryverse")
julia_install_package("FileIO")
julia_install_package("RDatasets")
julia_install_package("DataFrames")
julia_install_package("Downloads")
julia_install_package("CSV")
julia_install_package("StatsBase")
julia_install_package("StatsModels")
julia_install_package("Statistics")
julia_install_package("Plots")
julia_install_package("StatsPlots")
julia_install_package("Gadfly")
julia_install_package("Distances")
julia_install_package("Distributions")
julia_install_package("MultivariateStats")
julia_install_package("Econometrics")
julia_install_package("GLM")
julia_install_package("CovarianceMatrices")
julia_install_package("HypothesisTests")
julia_install_package("Dates")
julia_install_package("TimeSeries")
julia_install_package("Temporal")
julia_install_package("ARCHModels")
julia_install_package("GARCH")
julia_install_package("Missings")
julia_install_package("ShiftedArrays")
julia_install_package("CategoricalArrays")
julia_install_package("Chain")
julia_install_package("MixedModels")
julia_install_package("QuantileRegressions")
julia_install_package("KernelDensity")
julia_install_package("Clustering")
julia_install_package("MLBase")
julia_install_package("Lasso")
julia_install_package("Bootstrap")
julia_install_package("Random")
```

# Instalación separada de R, Python y Julia y configuración de Jupyter 

1. Instalar **R** (<https://cran.r-project.org/>), **Python** (<https://www.python.org/downloads/>) y **Julia** (<https://julialang.org/downloads/>)
    
2. Instalar **Jupyter**: ir al Terminal de MacOS/Windows —>

	python3 --version (py —version)
	
	python3 -m pip --version (py -m pip --version)
	
	python3 -m pip install jupyterlab (py -m pip install jupyterlab)

	Opcional (instalación del Notebook en lugar del Lab): python3 -m pip install notebook (py -m pip install notebook)
	
3. Instalación de **kernels de Julia y R**:

  a. Ir al Terminal de Julia ->

	  Pulsar ]
	
	  add **IJulia**
	
	  Pulsar Control+c

  b. Entrar en RStudio o en R para instalar **IRkernel** ->

	  install.packages("IRkernel")
	  
	  En el Terminal de MacOS entrar en R (en Windows entrar en R directamente)
	  
	  IRkernel: installspec()

4. Para comprobar que todo ha ido bien, ir al Terminal de MacOS/Windows ->

  python3 -m jupyter lab (py -m jupyter lab)
	
5. Instalar las librerías correspondientes en R, Python y Julia ->

  R -> install.packages(" _librería_")
  
  Python -> En el Terminal de MacOS/Windows -> python3 -m pip install _librería_
  
  Julia -> En el terminal de Julia -> pulsar ] -> add _librería_ -> pulsar Control+c
