---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---
# R code

```{r}
library(readxl)
capm <- read_excel("~/Documents/R/R_Python_Ramajo/IE4F/CAPM.xls")
head(capm)
summary(capm)
#
capm$r_sp = c(NA,100*diff(log(capm$SANDP)))
capm$r_ford = c(NA,100*diff(log(capm$FORD)))
capm$r_ge = c(NA,100*diff(log(capm$GE)))
capm$r_msoft = c(NA,100*diff(log(capm$MICROSOFT)))
capm$r_oracle = c(NA,100*diff(log(capm$ORACLE)))
capm$ustb3m = capm$USTB3M/12
capm$er_sp = capm$r_sp - capm$ustb3m
capm$er_ford = capm$r_ford - capm$ustb3m
#
par(cex.axis = 1.5, cex.lab = 1.5, lwd =  2)
plot(capm$Date,capm$er_sp,type='l',col = "red",ylim=c(-100,100),ylab="")
lines(capm$Date,capm$er_ford, lwd = 1)
legend("topright",c("SP500","Ford"), col = c("red","black"),lty=1,cex = 1.5)

plot(capm$er_sp,capm$er_ford,pch=19)

capm_ford = lm(er_ford ~ er_sp, data = capm)
summary(capm_ford)

library(car)
linearHypothesis(capm_ford,c("(Intercept)=0"))
linearHypothesis(capm_ford,c("er_sp=1"))
linearHypothesis(capm_ford,c("(Intercept)=0","er_sp=1"))
# linearHypothesis(capm_ford,hypothesis.matrix = diag(2),rhs = c(0,1))
```

# Python code

```{python}
import pandas as pd
import numpy as np
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt
#
capm = pd.read_excel('~/Documents/R/R_Python_Ramajo/IE4F/CAPM.xls', index_col=0)
capm.head()
capm.describe()
# 
def LogDiff(x):
    x_diff = 100*np.log(x/x.shift(1))
    return x_diff
    
data = pd.DataFrame({'r_sp' : LogDiff(capm['SANDP']),
                    'r_ford' : LogDiff(capm['FORD']),
                    'ustb3m' : capm['USTB3M']/12,
                    'er_sp' : LogDiff(capm['SANDP']) - capm['USTB3M']/12,
                    'er_ford' : LogDiff(capm['FORD']) - capm['USTB3M']/12})
data.head()
#
plt.figure(1)
plt.plot(data['er_sp'], label='Exceso de rendimiento de S&P')
plt.plot(data['er_ford'], label='Exceso de rendimiento de Ford')
plt.xlabel('Date')
plt.ylabel('%')
plt.title('Variables del modelo CAPM para la empresa Ford')
plt.grid(True)
plt.legend()
plt.show()
# 
plt.figure(2)
plt.scatter(data['er_sp'], data['er_ford'])
plt.xlabel('er_SP500')
plt.ylabel('er_FORD')
plt.title('Exceso de rendimiento de FORD frente a S&P500')
plt.grid(True)
plt.show()
# 
formula = 'er_ford ~ er_sp'
results = smf.ols(formula, data).fit()
print(results.summary())

hypotheses = 'Intercept = 0'
F_test = results.f_test(hypotheses)
print(F_test)

hypotheses = 'er_sp = 1'
F_test = results.f_test(hypotheses)
print(F_test)

hypotheses = 'Intercept = 0 , er_sp = 1'
F_test = results.f_test(hypotheses)
print(F_test)

```

