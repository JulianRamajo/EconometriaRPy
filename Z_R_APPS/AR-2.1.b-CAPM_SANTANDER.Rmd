---
title: 'Modelo de regresión lineal múltiple: estimación y contrastes de hipótesis'
author:
  name: Julián Ramajo, ramajo@unex.es
  affiliation: GRADO EN ESTADÍSTICA | ECONOMETRIA (502243)
subtitle: 'Modelo CAPM para las acciones del Banco Santander'
output:
  html_document:
    theme: journal
    highlight: haddock
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
---

# Código R

```{r, message=FALSE}
library(tidyverse)
CAPM_ESP <- read_csv("CAPM_ESP.csv")
ts_CAPM_ESP <- ts(CAPM_ESP, start=c(2001,5), end = c(2018,1), frequency = 12)
#
ts.plot(ts_CAPM_ESP[,"P_IBEX35"])
ts.plot(ts_CAPM_ESP[,"P_SANTANDER"])
#
ts.plot(ts_CAPM_ESP[,"R_SANTANDER"])
ts.plot(ts_CAPM_ESP[,"R_LT1Y"])
#
# Modelo CAPM para las acciones del Banco Santander 
# (repetir los cálculos para Telefónica e Inditex)
#
CAPM_SANTANDER  <-  lm(I(R_SANTANDER-R_LT1Y) ~ I(R_IBEX35-R_LT1Y), data = ts_CAPM_ESP)
summary(CAPM_SANTANDER)
#
# Intervalos de confianza para los parámetros estructurales del modelo
#
confint(CAPM_SANTANDER)
#
# Manualmente
#
alpha <- 0.05
df <- df.residual(CAPM_SANTANDER) # grados de libertad
t_c <- qt(1-alpha/2, df)
#
b1 <- coef(CAPM_SANTANDER)[[1]] # estimación del parámetro beta1
b1
seb1 <- sqrt(vcov(CAPM_SANTANDER)[1,1]) # estimación de la desviación típica de beta1
seb1
#
inf_b1 <- b1-t_c*seb1 # cota inferior
sup_b1 <- b1+t_c*seb1 # cota superior
inf_b1 ; sup_b1
#
b2 <- coef(CAPM_SANTANDER)[[2]] # estimación del parámetro beta2
b2
seb2 <- sqrt(vcov(CAPM_SANTANDER)[2,2]) # estimación de la desviación típica de beta2
seb2
#
inf_b2 <- b2-t_c*seb2 # cota inferior
sup_b2 <- b2+t_c*seb2 # cota superior
inf_b2 ; sup_b2
#
# Ajuste del modelo (R^2) y ANOVA
#
s_CAPM_SANTANDER <- summary(CAPM_SANTANDER)
print(s_CAPM_SANTANDER)
names(s_CAPM_SANTANDER)
R2 <- s_CAPM_SANTANDER$r.squared
R2
anova(CAPM_SANTANDER)
# Número de obsevaciones
T <- nobs(CAPM_SANTANDER)
T
# Número de parámetros
K <- T-df
K
# EStadístico F de significación global
F_0 <- (R2/(K-1))/((1-R2)/(T-K))
F_0
# Residuos del modelo
res <- s_CAPM_SANTANDER$residuals
res <- ts(res, start=c(2001,5), end = c(2018,1), frequency = 12)
plot(res)
#
ehat <- resid(CAPM_SANTANDER)
ebar <- mean(ehat)
sdehat <- sd(ehat)
hist(ehat, col="grey", freq=FALSE, main="", ylab="density", xlab="ehat")
curve(dnorm(x, ebar, sdehat), col=2, add=TRUE, ylab="density", xlab="ehat")
#
# Contrastes de hipótesis
#
# beta1=0 versus beta1≠0
#
# Estadístico t
#
alpha <- 0.05 # nivel de significación
b1 <- coef(CAPM_SANTANDER)[[1]] # estimación del parámetro beta1
b1
seb1 <- sqrt(vcov(CAPM_SANTANDER)[1,1]) # estimación de la desviación típica de beta1
seb1
c <- 0
df <- df.residual(CAPM_SANTANDER) # grados de libertad
t_0 <- (b1-c)/seb1 # estadístico t
t_0
# Método del valor crítico
t_c <- qt(1-alpha/2, df) # valor crítico
t_c
# Gráfico de la función de densidad de la distribución t de Student, del valor crítico y del estadístico t:
curve(dt(x, df), -5, 5, ylab=" ", xlab="t")
abline(v=c(-t_c, t_c, t_0), col=c("red", "red", "blue"), lty=c(2,2,3))
legend("topleft", legend=c("-t_c", "t_c", "t_0"), col=c("red", "red", "blue"), lty=c(2, 2, 3))
# Método del P-valor
p <- 2*(1-pt(abs(t_0), df))
p
# Gráfico de la función de densidad de la distribución t de Student y del estadístico t_0:
curve(dt(x, df), -5, 5, ylab=" ", xlab="t")
abline(v=c(t_0), col=c("blue"), lty=c(3))
legend("topleft", legend=c("t_0"), col=c("blue"), lty=c(3))
#
# Estadístico F
#
library(car)
H_0 <- "(Intercept) = 0"
linearHypothesis(CAPM_SANTANDER,H_0,test="F")
#
# Gráfico de la función de densidad de la distribución F de Fisher-Snedecor y del estadístico F_0:
F_0 <- linearHypothesis(CAPM_SANTANDER,H_0,test="F")[2,5] # estadístico F
F_0
F_c <- qf(1-alpha, 1, df) # valor crítico
F_c
#
curve(df(x, 1, df), 0, 5, ylab=" ", xlab="F")
abline(v=c(F_0,F_c), col=c("blue","red"), lty=c(2,3))
legend("topleft", legend=c("F","Fcr"), col=c("blue","red"), lty=c(2,3))
#
# beta2=1 versus beta2≠1
#
# Estadístico t
# 
alpha <- 0.05 # nivel de significación
b2 <- coef(CAPM_SANTANDER)[[2]] # estimación del parámetro beta2
b2
seb2 <- sqrt(vcov(CAPM_SANTANDER)[2,2]) # estimación de la desviación típica de beta2
seb2
c <- 1
df <- df.residual(CAPM_SANTANDER) # grados de libertad
t_0 <- (b2-c)/seb2 # estadístico t
t_0
# Método del valor crítico
t_c <- qt(1-alpha/2, df) # valor crítico
t_c
# Gráfico de la función de densidad de la distribución t de Student, del valor crítico y del estadístico t:
curve(dt(x, df), -6, 6, ylab=" ", xlab="t")
abline(v=c(-t_c, t_c, t_0), col=c("red", "red", "blue"), lty=c(2,2,3))
legend("topleft", legend=c("-t_c", "t_c", "t_0"), col=c("red", "red", "blue"), lty=c(2, 2, 3))
# Método del P-valor
p <- 2*(1-pt(abs(t_0), df))
p
# Gráfico de la función de densidad de la distribución t de Student y del estadístico t:
curve(dt(x, df), -6, 6, ylab=" ", xlab="t")
abline(v=c(t_0), col=c("blue"), lty=c(3))
legend("topleft", legend=c("t_0"), col=c("blue"), lty=c(3))
#
# Estadístico F
H_0 <- "I(R_IBEX35 - R_LT1Y) = 1"
linearHypothesis(CAPM_SANTANDER,H_0,test="F")
#
# Contraste conjunto de la hipótesis beta1=0, beta2=1
#
H_0 <- c("(Intercept) = 0", "I(R_IBEX35 - R_LT1Y) = 1")
linearHypothesis(CAPM_SANTANDER,H_0,test="F")
#
# Contrastes unilaterales
# 
# beta2≤1 versus beta2>1
#
c <- 1
alpha <- 0.05
t_0 <- (b2-c)/seb2
t_0
# Método del valor crítico
t_c <- qt(1-alpha, df) # alpha no se divide por 2
t_c
#
curve(dt(x, df), -6, 6, ylab=" ", xlab="t")
abline(v=c(t_c, t_0), col=c("red", "blue"), lty=c(2, 3))
legend("topleft", legend=c("t_c", "t_0"), col=c("red", "blue"), lty=c(2, 3))
# Método del P-valor
p <- 1-pt(t_0, df)
p
# 
# beta2≥2 versus beta2<2
#
c <- 2
alpha <- 0.05
t_0 <- (b2-c)/seb2
t_0
# Método del valor crítico
t_c <- qt(alpha, df) # alpha no se divide por 2
t_c
#
curve(dt(x, df), -20, 20, ylab=" ", xlab="t")
abline(v=c(t_c, t_0), col=c("red", "blue"), lty=c(2, 3))
legend("topleft", legend=c("t_c", "t_0"), col=c("red", "blue"), lty=c(2, 3))
# Método del P-valor
p <- pt(t_0, df)
p
```
