---
title: 'TEMA 1: INTRODUCCIÓN A LA ECONOMETRÍA'
author:
  name: Julián Ramajo, ramajo@unex.es
  affiliation: GRADO EN ESTADÍSTICA | ECONOMETRIA (502243)
subtitle: 'Aplicación 1.1 (Datos de corte transversal): Demanda familiar de carne'
output:
  html_document:
    theme: journal
    highlight: haddock
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
---

# Introducción

En esta aplicación se estimará una función de demanda estándar con datos micro sobre 30 familias americanas:

$$Q = f(P, Y) + e$$

# Código R

## Lectura de librerías y datos, y análisis exploratorio (EDA) de la muestra

```{r}
# Lectura de librerías
library(tidyverse)
library(GGally)
library(skimr)
library(coefplot)
library(report)
# Lectura de datos 
DEM_CARNE <- read_csv("DEM_CARNE.csv")
#
dim(DEM_CARNE)
str(DEM_CARNE)
head(DEM_CARNE)
tail(DEM_CARNE)
# Estadística descriptiva
summary(DEM_CARNE)
report(DEM_CARNE)
skim(DEM_CARNE)
# Gráficas parciales
GGally::ggpairs(DEM_CARNE)
#
ggplot(DEM_CARNE, aes(x = P, y = Q)) +
  geom_point(color = "blue") +
  geom_jitter(color = "blue") +
  geom_function(fun = function(x) {y = mean(DEM_CARNE$Q)}, linetype = "dotdash") +
  geom_smooth(method='lm', formula = y~x, se = FALSE, color = "red", linetype = "dashed") +
  xlab("P (precio)") +
  ylab("Q (cantidad)") +
  theme_minimal()
ggplot(DEM_CARNE, aes(x = Y, y = Q)) +
  geom_point(color = "blue") +
  geom_jitter(color = "blue") +
  geom_function(fun = function(x) {y = mean(DEM_CARNE$Q)}, linetype = "dotdash") +
  geom_smooth(method='lm', formula = y~x, se = FALSE, color = "red", linetype = "dashed") +
  xlab("Y (renta)") +
  ylab("Q (cantidad)") +
  theme_minimal()
```

## Regresión MCO del modelo lineal:

$$Q = \beta_0 + \beta_1P + \beta_2Y + e$$

```{r}
lin_model <- lm(formula = Q ~ P + Y, data = DEM_CARNE)
summary(lin_model)
report(lin_model)
coefplot(lin_model)
```

## Visualización 3D de los datos y del plano ajustado del modelo

```{r}
library(plotly)
library(magrittr)
#  
model <- lm(Q ~ P + Y, data = DEM_CARNE)  
plot_ly(data = DEM_CARNE) %>%
    add_trace(x = ~P, y = ~Y, z = ~Q, mode = "markers", type = "scatter3d",
              marker = list(size = 5, color = "blue", symbol = 104), name = "Observaciones") %>% 
    add_trace(z = model$fitted.values, x = ~P, y = ~Y, type = "mesh3d", 
              name = "Valores ajustados") %>%
    layout(scene = list(xaxis = list(title = 'P'), yaxis = list(title = 'Y'),
                        camera = list(eye = list(x = -1.5, y = 1.5, z = 0)),
                        zaxis = list(title = 'Q'), aspectmode='cube')) 
```

## Regresión MCO del modelo logarítmico-lineal (log-log):

$$log(Q) = \beta_0 + \beta_1log(P) + \beta_2log(Y) + e$$

```{r}
log_model <- lm(log(Q) ~ log(P) + log(Y), data = DEM_CARNE)
summary(log_model)
report(log_model)
coefplot(log_model)
```

# Código Python

## Regresión MCO del modelo lineal:

$$Q = \beta_0 + \beta_1P + \beta_2Y + e$$

```{python}
import pandas as pd
import statsmodels.formula.api as smf
#
DEM_CARNE = pd.read_csv("DEM_CARNE.csv")
model = smf.ols(formula = "Q ~ P + Y", data = DEM_CARNE)
lin_model = model.fit()
print(lin_model.summary())
```

## Regresión MCO del modelo logarítmico-lineal:

$$log(Q) = \beta_0 + \beta_1log(P) + \beta_2log(Y) + e$$

```{python}
import numpy as np
# import pandas as pd
import statsmodels.formula.api as smf
# DEM_CARNE = pd.read_csv("DEM_CARNE.csv")
model = smf.ols(formula = "np.log(Q) ~ np.log(P) + np.log(Y)", data = DEM_CARNE)
log_model = model.fit()
print(log_model.summary())
```

# Código Julia

```{r, echo = FALSE}
#
library(JuliaCall)
julia <- julia_setup()
```

## Librerías, EDA y regresión MCO de los modelos lineal y logarítmico

```{julia, message = FALSE, warning = FALSE}
using DataFrames, CSV, GLM;
# Lectura de datos
DEM_CARNE = CSV.read("DEM_CARNE.csv", DataFrame);
#
size(DEM_CARNE)
names(DEM_CARNE)
show(first(DEM_CARNE,6))
show(last(DEM_CARNE,6))
# Estadística descriptiva
show(describe(DEM_CARNE))
# Regresión MCO del modelo lineal
# Librería GLM
lin_model = lm(@formula(Q ~ P + Y), DEM_CARNE)
# R^2
print("R^2 estándar ->   ",r2(lin_model))
#
using RegressionTables;
regtable(lin_model)
# Librería Econometrics
using Econometrics;
lin_model = fit(EconometricModel, @formula(Q ~ P + Y), DEM_CARNE)
# Regresión MCO del modelo logarítmico
log_model = lm(@formula(log(Q) ~ log(P) + log(Y)), DEM_CARNE)
#
using RegressionTables;
regtable(log_model)
```

# Anexo 1: Regresión no lineal (potencial en la variable renta) con R

```{r}
nonlin1_model <- nls(Q ~ c1 + c2*P + c3*(Y^c4), start = list(c1=5, c2=-0.5, c3=0.01, c4=3), data = DEM_CARNE)
summary(nonlin1_model)
#
library(gslnls)
nonlin2_model <- gsl_nls(Q ~ c1 + c2*P + c3*(Y^c4), start = c(c1=5, c2=-0.5, c3=0.01, c4=3), data = DEM_CARNE)
summary(nonlin2_model)
```

# Anexo 2: Regresión lineal Bayesiana con R

```{r}
library(rstanarm)
#
linBayes1_model <- stan_glm(Q ~ P + Y, data = DEM_CARNE)
summary(linBayes1_model)
report(linBayes1_model)
#
library(INLA)
library(brinla)
#
linBayes2_model <- inla(Q ~ P + Y, family = "gaussian", data = DEM_CARNE)
summary(linBayes2_model)
bri.hyperpar.summary(linBayes2_model)
bri.fixed.plot(linBayes2_model)
bri.hyperpar.plot(linBayes2_model)
```
