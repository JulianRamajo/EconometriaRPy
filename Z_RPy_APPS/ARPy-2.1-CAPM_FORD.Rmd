---
title: 'TEMA 2: Modelo de regresión lineal múltiple: Estimación y contrastes de hipótesis'
author:
  name: Julián Ramajo, ramajo@unex.es
  affiliation: GRADO EN ESTADÍSTICA | ECONOMETRIA (502243)
subtitle: 'Aplicación 2.1: El modelo CAPM (Capital Asset Pricing Model)'
output:
  html_document:
    theme: journal
    highlight: haddock
    toc: yes
    toc_depth: 2
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
---

# Código R

```{r, message=FALSE}
# Lectura de librerías
library(tidyverse)
library(readxl)
# Lectura de datos
capm <- read_excel("CAPM_USA.xls")
head(capm)
tail(capm)
summary(capm[,2:6])
# Transformación de variables
capm$r_sp = c(NA,100*diff(log(capm$SANDP)))
capm$r_ford = c(NA,100*diff(log(capm$FORD)))
capm$r_ge = c(NA,100*diff(log(capm$GE)))
capm$r_msoft = c(NA,100*diff(log(capm$MICROSOFT)))
capm$r_oracle = c(NA,100*diff(log(capm$ORACLE)))
capm$mustb3m = capm$USTB3M/12
capm$er_sp = capm$r_sp - capm$mustb3m
capm$er_ford = capm$r_ford - capm$mustb3m
# Gráficas
par(cex.axis = 1.5, cex.lab = 1.5, lwd =  2)
plot(capm$Date,capm$er_sp,type='l',col = "red",ylim=c(-100,100),ylab="")
lines(capm$Date,capm$er_ford, lwd = 1)
legend("topright",c("Exceso de rendimiento de SP500","Exceso de rendimiento de Ford"), col = c("red","black"),lty=1,cex = 1.5)
#
g1 <- ggplot(capm, aes(x=er_sp, y=er_ford)) +
  geom_point()  + labs(x = "er_SP500", y = "er_FORD", title = "Exceso de rendimiento de FORD frente a SP500")
g1
# Estimación del modelo
capm_ford = lm(er_ford ~ er_sp, data = capm)
summary(capm_ford)
# Contrastes de hipótesis
library(car)
H_0 <- c("(Intercept)=0")
linearHypothesis(capm_ford, H_0)
#
H_0 <- c("er_sp=1")
linearHypothesis(capm_ford, H_0)
#
H_0 <- c("(Intercept)=0","er_sp=1")
linearHypothesis(capm_ford, H_0)
# linearHypothesis(capm_ford,hypothesis.matrix = diag(2),rhs = c(0,1))
```

# Código Python

```{python, message=FALSE}
# Lectura de librerías
import pandas as pd
import numpy as np
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt
# Lectura de datos
capm = pd.read_excel('CAPM_USA.xls', index_col=0)
capm.head()
capm.tail()
capm.describe()
# Transformación de variables
def LogDiff(x):
    x_diff = 100*np.log(x/x.shift(1))
    return x_diff
capm['r_sp'] = LogDiff(capm['SANDP'])
capm['r_ford'] = LogDiff(capm['FORD'])
capm['mustb3m'] = capm['USTB3M']/12
capm['er_sp'] = LogDiff(capm['SANDP']) - capm['USTB3M']/12
capm['er_ford'] = LogDiff(capm['FORD']) - capm['USTB3M']/12
# Gráficas
plt.figure(1)
plt.plot(capm['er_sp'], label='Exceso de rendimiento de SP500')
plt.plot(capm['er_ford'], label='Exceso de rendimiento de Ford')
plt.xlabel('Date')
plt.ylabel('%')
plt.title('Variables del modelo CAPM para la empresa Ford')
plt.grid(True)
plt.legend()
plt.show()
# 
plt.figure(2)
plt.scatter(capm['er_sp'], capm['er_ford'])
plt.xlabel('er_SP500')
plt.ylabel('er_FORD')
plt.title('Exceso de rendimiento de FORD frente a SP500')
plt.grid(True)
plt.show()
# Estimación del modelo
formula = 'er_ford ~ er_sp'
results = smf.ols(formula, capm).fit()
print(results.summary())
# Contrastes de hipótesis
H_0 = 'Intercept = 0'
F_test = results.f_test(H_0)
print(F_test)
#
H_0 = 'er_sp = 1'
F_test = results.f_test(H_0)
print(F_test)
#
H_0 = 'Intercept = 0 , er_sp = 1'
F_test = results.f_test(H_0)
print(F_test)
```

