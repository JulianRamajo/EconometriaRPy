---
title: "TEMA 1: INTRODUCCIÓN A LA ECONOMETRÍA"
subtitle: 'Aplicación 1.1 (Datos de corte transversal): Demanda familiar de carne'
author:
  name: Julián Ramajo
  affiliation: Universidad de Extremadura
  email: ramajo@unex.es
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document:
    theme: flatly
    highlight: haddock 
    toc: yes
    toc_depth: 3
    toc_float: yes
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = FALSE)
```

# Introducción

En esta aplicación se estimará una función de demanda estándar con datos micro sobre el consumo de carne de 30 familias americanas ( _i_ = 1, 2,..., 30):

$$Q_i = \beta_1 + \beta_2 {P_i} + \beta_3 {Y_i} + e_i$$

# Código R

## Lectura de librerías

```{r, message = FALSE, warning = FALSE, eval=T}
library(tidyverse)
library(GGally)
library(skimr)
library(coefplot)
library(report)
```

## Lectura de datos

```{r, message = FALSE, warning = FALSE, eval=T}
DEM_CARNE <- read_csv("DEM_CARNE.csv")
dim(DEM_CARNE)
str(DEM_CARNE)
head(DEM_CARNE)
tail(DEM_CARNE)
```

## Análisis exploratorio (EDA)

```{r, message = FALSE, warning = FALSE, eval=T}
# Estadística descriptiva
summary(DEM_CARNE)
report(DEM_CARNE)
skim(DEM_CARNE)
# Gráficas parciales
GGally::ggpairs(DEM_CARNE)
ggplot(DEM_CARNE, aes(x = P, y = Q)) +
  geom_point(color = "blue") +
  geom_jitter(color = "blue") +
  geom_function(fun = function(x) {y = mean(DEM_CARNE$Q)}, linetype = "dotdash") +
  geom_smooth(method='lm', formula = y~x, se = FALSE, color = "red", linetype = "dashed") +
  xlab("P (precio)") +
  ylab("Q (cantidad)") +
  theme_minimal()
ggplot(DEM_CARNE, aes(x = Y, y = Q)) +
  geom_point(color = "blue") +
  geom_jitter(color = "blue") +
  geom_function(fun = function(x) {y = mean(DEM_CARNE$Q)}, linetype = "dotdash") +
  geom_smooth(method='lm', formula = y~x, se = FALSE, color = "red", linetype = "dashed") +
  xlab("Y (renta)") +
  ylab("Q (cantidad)") +
  theme_minimal()
```

## Regresión MCO

```{r, message = FALSE, warning = FALSE, eval=T}
lin_model <- lm(formula = Q ~ P + Y, data = DEM_CARNE)
summary(lin_model)
report(lin_model)
coefplot(lin_model)
```

# Código Python

## Lectura de librerías

```{python, message = FALSE, warning = FALSE, eval=T}
import numpy as np
import pandas as pd
import statsmodels.api as sm
import statsmodels.formula.api as smf
```

## Lectura de datos

```{python, message = FALSE, warning = FALSE, eval=T}
DEM_CARNE = pd.read_csv("DEM_CARNE.csv")
DEM_CARNE.head()
DEM_CARNE.tail()
```

## Análisis exploratorio (EDA)

```{python, message = FALSE, warning = FALSE, eval=T}
DEM_CARNE.describe()
```

## Regresión MCO

```{python, message = FALSE, warning = FALSE, eval=T}
model = smf.ols(formula = "Q ~ P + Y", data = DEM_CARNE)
lin_model = model.fit()
print(lin_model.summary())
```

# Código Julia

```{r, echo = FALSE, eval=T}
library(JuliaCall)
julia <- julia_setup()
```

## Lectura de librerías

```{julia, message = FALSE, warning = FALSE, eval=T}
using DataFrames, CSV;
using GLM, Econometrics, RegressionTables;
```

## Lectura de datos

```{julia, message = FALSE, warning = FALSE, eval=T}
DEM_CARNE = CSV.read("DEM_CARNE.csv", DataFrame)
size(DEM_CARNE)
names(DEM_CARNE)
show(first(DEM_CARNE,6))
show(last(DEM_CARNE,6))
```

## Análisis exploratorio (EDA)

```{julia, message = FALSE, warning = FALSE, eval=T}
show(describe(DEM_CARNE))
```

## Regresión MCO (librería Econometrics)

```{julia, message = FALSE, warning = FALSE, eval=T}
lin_model = fit(EconometricModel, @formula(Q ~ P + Y), DEM_CARNE)
```

## Regresión MCO (librería GLM)

```{julia, message = FALSE, warning = FALSE, eval=T}
lin_model = lm(@formula(Q ~ P + Y), DEM_CARNE)
print("R^2 estándar ->   ",r2(lin_model))
regtable(lin_model)
```
